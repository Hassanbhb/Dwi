const dropdownBtns=document.querySelectorAll(".dotsMenu");dropdownBtns.forEach((e=>{e.addEventListener("click",(t=>{e.nextSibling.classList.add("show-dropdown")}))}));const main_header=document.querySelector(".main-header"),nav_btn=document.querySelector(".nav-toggle");function ajaxFunction(e,t,o,n){const s=new XMLHttpRequest;s.open(e,t,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=()=>{if(4==s.readyState&&200===s.status){const e=JSON.parse(s.response);messageDisplay(e.hasOwnProperty("error"),e,n)}},s.send(o)}window.onclick=e=>{if(!e.target.matches(".dotsMenu")){document.querySelectorAll(".dropdown-content").forEach((e=>{e.classList.contains("show-dropdown")&&e.classList.remove("show-dropdown")}))}e.target.matches(".main-header")||e.target.matches(".nav-toggle")||main_header.classList.remove("active")},document.addEventListener("DOMContentLoaded",(function(e){var t=sessionStorage.getItem("scrollpos");t&&window.scrollTo(0,t)})),window.onbeforeunload=function(e){sessionStorage.setItem("scrollpos",window.scrollY)};const postForm=document.querySelector(".createPost");postForm.addEventListener("submit",(e=>{e.preventDefault();const t=`newPost=${document.querySelector(".postTextArea").value}`;ajaxFunction("POST",window.location.href+"/new/post",t,!0)}));const postTextArea=document.querySelector(".postTextArea"),sizeDisplay=document.querySelector("span.size");postTextArea.addEventListener("input",(e=>{const t=e.target.value;sizeDisplay.innerHTML=t.length,sizeDisplay.style.color="green",t.length>3e3&&(sizeDisplay.style.color="red")}));const commentForms=document.querySelectorAll(".comments > form");commentForms.forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault();const t=`postId=${e.target.elements[0].value}&comment=${e.target.elements[1].value}`;ajaxFunction("PUT",window.location.href+"/new/comment",t,!0)}))}));const commentInputs=document.querySelectorAll('.comments > form > input[name="comment"]');commentInputs.forEach((e=>{e.addEventListener("input",(e=>{const t=e.target.value,o=e.target.form.parentElement.previousSibling.lastElementChild.firstElementChild;o.innerHTML=t.length,o.style.color="green",t.length>250&&(o.style.color="red")}))}));const deleteBtns=document.querySelectorAll(".deleteBtn");deleteBtns.forEach((e=>{e.addEventListener("click",(e=>{let t,o,n;e.preventDefault(),e.target.getAttribute("data-post-Id")?(o=window.location.href+"/delete/post",t=e.target.getAttribute("data-post-Id"),n="DELETE"):(o=window.location.href+"/delete/comment",t=e.target.getAttribute("data-Id"),n="PUT");const s=new XMLHttpRequest;s.open(n,o,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200===s.status&&(location.href="/dashboard")},s.send(`postId=${t}`)}))}));const likeBtn=document.querySelectorAll(".likeBtn");likeBtn.forEach((e=>{e.addEventListener("click",(e=>{const t=window.location.href+"/new/like",o=e.target.getAttribute("data-postID")||e.target.parentNode.getAttribute("data-postID");console.log(o);const n=new XMLHttpRequest;n.open("PUT",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200===n.status&&location.reload()},n.send(`postId=${o}`)}))}));const commentsBtn=document.querySelectorAll(".comments-btn");commentsBtn.forEach((e=>{e.addEventListener("click",(e=>{e.target.parentElement.parentElement.nextSibling.nextSibling.lastElementChild.classList.toggle("comments-hide")}))}));const modal=document.querySelector(".editModal"),editModelBtn=document.querySelectorAll(".editModelBtn"),closeBtn=document.querySelector(".close-modal"),hiddenInput=document.querySelector(".modelHiddenInput"),textArea=document.querySelector(".editArea");editModelBtn.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.getAttribute("data-postID"),o=e.target.getAttribute("data-postBody");hiddenInput.value=t,textArea.value=o,modal.style.display="block"}))})),closeBtn.addEventListener("click",(e=>{modal.style.display="none"})),nav_btn.addEventListener("click",(e=>{main_header.classList.toggle("active")}));const message=document.querySelector(".message"),message_body=document.querySelector(".message-body");function messageDisplay(e,t,o){e?(message.classList.add("message-error"),message.classList.remove("hide-message"),setTimeout((function(){message.classList.add("hide-message")}),5e3),message_body.innerHTML=t.error.body):o?location.href="/dashboard":(message.classList.add("message-success"),message.classList.remove("hide-message"),setTimeout((()=>{message.classList.add("hide-message")}),5e3),message_body.innerHTML=t.success.body)}